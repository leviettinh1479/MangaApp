<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Modernize Free</title>
  <link rel="shortcut icon" type="image/png" href="/assets/images/logos/favicon.png" />
  <link rel="stylesheet" href="/assets/css/styles.min.css" />
  <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

</head>

<body>
  <!--  Body Wrapper -->
  <div class="page-wrapper" id="main-wrapper" data-layout="vertical" data-navbarbg="skin6" data-sidebartype="full"
    data-sidebar-position="fixed" data-header-position="fixed">
    <!-- Sidebar Start -->
   <aside class="left-sidebar">
    <!-- Sidebar scroll-->
    <div>
      <div class="brand-logo d-flex align-items-center justify-content-between">
        <a href="./index.html" class="text-nowrap logo-img">
           <img src="/assets/images/logos/Screenshot 2023-11-02 213605.png" style="margin-top: 20px;" width="180" alt="" />
        </a>
        <div class="close-btn d-xl-none d-block sidebartoggler cursor-pointer" id="sidebarCollapse">
          <i class="ti ti-x fs-8"></i>
        </div>
      </div>
      <!-- Sidebar navigation-->

      <nav class="sidebar-nav scroll-sidebar" data-simplebar="">
        <ul id="sidebarnav">
          <li class="nav-small-cap">
            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
            <span class="hide-menu">Home</span>
          </li>
          <li class="sidebar-item">
            <a class="sidebar-link" href="http://localhost:3000/home" aria-expanded="false">
              <span>
                <i class="ti ti-layout-dashboard"></i>
              </span>
              <span class="hide-menu">Home</span>
            </a>
          </li>
          <li class="nav-small-cap">
            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
            <span class="hide-menu">Manager</span>
          </li>
          <li class="sidebar-item">
            <a class="sidebar-link" href="http://localhost:3000/getAllUser" aria-expanded="false">
              <span>
                <i class="ti ti-article"></i>
              </span>
              <span class="hide-menu">User Account</span>
            </a>
          </li>
          <li class="sidebar-item">
            <a class="sidebar-link" href="http://localhost:3000/addmanga" aria-expanded="false">
              <span>
                <i class="ti ti-file-description"></i>
              </span>
              <span class="hide-menu">Add Manga</span>
            </a>
          </li>

          <li class="nav-small-cap">
            <i class="ti ti-dots nav-small-cap-icon fs-4"></i>
            <span class="hide-menu">AUTH</span>
          </li>
          <li class="sidebar-item">
            <a class="sidebar-link" href="http://localhost:3000/logout" aria-expanded="false">
              <span>
                <i class="ti ti-login"></i>
              </span>
              <span class="hide-menu">Log out</span>
            </a>
          </li>


        </ul>

      </nav>

      <!-- End Sidebar navigation -->
    </div>
    <!-- End Sidebar scroll-->
  </aside>
    <!--  Sidebar End -->
    <!--  Main wrapper -->
    <div class="body-wrapper">
      <!--  Header Start -->

      <!--  Header End -->
      <div class="container-fluid">
        <div class="card">
          <div class="card-body" style="display: flex; justify-content: space-between;">
            {{#each mangaData}}
            <img src="{{this.image}}" style="object-fit: fill; border-radius: 20px; box-shadow: 0 0 8px #111;"
              width="30%" height="400" alt="Hình ảnh" />
            <div style="width: 68%;">
              <h1 style="color: #111;">{{this.name}}</h1>
              <div style="display: flex;">
                <div style="width: 30%;">
                  <p style="font-size: 20px; color: #111; align-items: center; font-weight: bold;">
                    <i class='bx bxs-user' style="font-size: 20px;"></i> Tác giả
                  </p>
                  <p style="font-size: 20px; color: #111; align-items: center; font-weight: bold;">
                    <i class='bx bx-wifi' style="font-size: 20px;"></i> Tình trạng
                  </p>
                  <p style="font-size: 20px; color: #111; align-items: center; font-weight: bold;">
                    <i class='bx bxs-like' style="font-size: 20px;"></i> Lượt thích
                  </p>
                  <p style="font-size: 20px; color: #111; align-items: center; font-weight: bold;">
                    <i class='bx bxs-happy-heart-eyes' style="font-size: 20px;"></i> Lượt xem
                  </p>
                </div>
                <div style="width: 70%;">
                  <p style="font-size: 20px; color: #111;">{{this.author}}</p>
                  <p style="font-size: 20px; color: #111;">Đang cập nhật</p>
                  <p style="font-size: 20px; color: #111;">236</p>
                  <p style="font-size: 20px; color: #111;">150,637</p>
                </div>
              </div>
              <div>
                <h3 style="color: #f18121;">
                  <i class='bx bxs-info-circle'></i> Giới thiệu
                </h3>
                <p style="font-size: 16px; color: #111;">Truyện tranh The Strongest Virus được cập nhật nhanh và đầy đủ
                  nhất tại TruyenQQ. Bạn đọc đừng quên để lại bình luận và chia sẻ, ủng hộ TruyenQQ ra các chương mới
                  nhất của truyện The Strongest Virus.</p>
              </div>
            </div>
          </div>
          <a href="/home/{{this._id}}/addchapter" class="btn btn-primary" style="align-self: center;width: 200;">Add Chapter</a>
        {{/each}}
          <div class="card-body">
            <h3 style="color: #f18121;">
              <i class='bx bxs-info-circle'></i> Danh sách chương
            </h3>
            {{#each chapterData}}
            <div style="border-width: 3px; border-color: #f18121;">
              <a href="http://localhost:3000/home/chapter/{{this._id}}">
                <div style="display: flex; justify-content: space-between; border-width: 3px;">
                  <div style="display: flex;">
                    <p style="font-size: 16px; color: #111;">Tập {{this.chap}}:</p>
                    <p style="font-size: 16px; color: #111; margin-left: 5px;">{{this.title}}</p>
                  </div>
                  <div>
                    <p style="font-size: 16px; color: #111;">28/05/2021</p>
                  </div>
                  <div>
              
              </div>
                </div>
              </a>
              <div class="row">
                <div class="col-1">
                  <button class="btn btn-danger" onclick="confirmDelete('{{this._id}}');">Delete</button>
                </div>
                <div class="col-1">
                  <a href="/home/{{this._id}}/updatechapter" class="btn btn-primary">Edit</a>
                </div>
              </div>
                
              {{/each}}
            </div>
          </div>
        </div>
      </div>
      <script src="/assets/libs/jquery/dist/jquery.min.js"></script>
      <script src="/assets/libs/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
      <script src="/assets/js/sidebarmenu.js"></script>
      <script src="/assets/js/app.min.js"></script>
      <script src="/assets/libs/simplebar/dist/simplebar.js"></script>
      <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script>
  const fetchAPI = async (url, option) => {
    const res = await fetch(url, option);
    return res.json();
  }

  const deleteChapter = async (id) => {
    const url = `/api/chapter/${id}`;
    const option = {
      method: 'delete',
      headers: { 'Content-Type': 'application/json' }
    }
    try {
      const result = await fetchAPI(url, option);
      console.log('Delete result: ', result);
      if (result.success === true) {
        window.location.reload();
      } else {
        swal('Xóa Thất bại!', {
          icon: 'error',
        });
      }
    } catch (e) {
      console.log('Delete error: ', e);
    }
  }

  const confirmDelete = (id) => {
    swal({
      title: "Xác nhận xóa?",
      text: "Bạn có chắc muốn xóa chapter này không?",
      icon: "warning",
      buttons: true,
      dangerMode: true,
    })
      .then((willDelete) => {
        if (willDelete) {
          deleteChapter(id);
        }
      });
  }
</script>
</body>

</html>